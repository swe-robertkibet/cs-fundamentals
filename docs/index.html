<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sorting Algorithm Visualizer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        color: #e2e8f0;
        min-height: 100vh;
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 1rem;
      }

      h1 {
        text-align: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 2rem;
        font-size: clamp(1.8rem, 4vw, 3rem);
        font-weight: 700;
        letter-spacing: -0.025em;
      }

      .controls-section {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        align-items: center;
        transition: all 0.3s ease;
      }

      .controls-section.hidden {
        display: none;
      }

      .slider-container {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .slider-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 500;
        font-size: 0.9rem;
        color: #cbd5e1;
      }

      .slider-value {
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 600;
      }

      .limit-info {
        font-size: 0.75rem;
        color: #94a3b8;
        margin-top: 0.25rem;
      }

      .slider {
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: rgba(255, 255, 255, 0.1);
        outline: none;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        transition: all 0.2s ease;
      }

      .slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
      }

      .slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        cursor: pointer;
        border: none;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        justify-content: center;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
      }

      .controls.hidden {
        display: none;
      }

      .animation-controls {
        display: none;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        align-items: center;
        justify-content: space-between;
        gap: 2rem;
      }

      .animation-controls.visible {
        display: flex;
      }

      .animation-controls .slider-container {
        flex: 1;
        max-width: 300px;
      }

      button {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        min-width: 120px;
        text-align: center;
      }

      button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      button:hover::before {
        left: 100%;
      }

      button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      button:active:not(:disabled) {
        transform: translateY(0);
      }

      button:disabled {
        background: rgba(148, 163, 184, 0.2);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      button:disabled::before {
        display: none;
      }

      .stop-btn {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        display: none;
      }

      .stop-btn:hover:not(:disabled) {
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
      }

      .stop-btn.visible {
        display: inline-block;
      }

      .visualization {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        display: flex;
        align-items: end;
        justify-content: center;
        height: clamp(420px, 50vh, 600px);
        overflow: hidden;
      }

      .bar {
        background: linear-gradient(180deg, #3b82f6 0%, #1e40af 100%);
        margin: 0 1px;
        border-radius: 4px 4px 0 0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: end;
        justify-content: center;
        color: white;
        font-size: clamp(8px, 1vw, 12px);
        font-weight: 600;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        position: relative;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        min-width: 4px;
      }

      .bar.comparing {
        background: linear-gradient(180deg, #f59e0b 0%, #d97706 100%);
        transform: scale(1.05);
        box-shadow: 0 4px 16px rgba(245, 158, 11, 0.5);
        z-index: 10;
      }

      .bar.swapping {
        background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6);
        z-index: 20;
      }

      .bar.sorted {
        background: linear-gradient(180deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .stat {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1.5rem;
        border-radius: 12px;
        text-align: center;
        transition: all 0.3s ease;
      }

      .stat:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-2px);
      }

      .stat-label {
        font-size: 0.875rem;
        color: #94a3b8;
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .info {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 2rem;
      }

      .info h3 {
        margin-bottom: 1rem;
        color: #f1f5f9;
        font-size: 1.25rem;
      }

      .info p {
        margin-bottom: 0.75rem;
        color: #cbd5e1;
        font-size: 0.9rem;
      }

      .color-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
      }

      .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 4px;
      }

      .legend-normal {
        background: linear-gradient(180deg, #3b82f6 0%, #1e40af 100%);
      }
      .legend-comparing {
        background: linear-gradient(180deg, #f59e0b 0%, #d97706 100%);
      }
      .legend-swapping {
        background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
      }
      .legend-sorted {
        background: linear-gradient(180deg, #10b981 0%, #059669 100%);
      }

      @media (max-width: 768px) {
        .container {
          padding: 0.75rem;
        }

        .controls-section {
          grid-template-columns: 1fr;
          padding: 1rem;
        }

        .animation-controls {
          flex-direction: column;
          gap: 1rem;
          padding: 1rem;
        }

        .animation-controls .slider-container {
          max-width: none;
        }

        .controls {
          justify-content: stretch;
        }

        button {
          flex: 1;
          min-width: 0;
        }

        .visualization {
          padding: 1rem;
          height: clamp(350px, 45vh, 500px);
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
        }

        .info {
          padding: 1.5rem;
        }
      }

      @media (max-width: 480px) {
        .stats {
          grid-template-columns: 1fr;
        }

        .color-legend {
          flex-direction: column;
          gap: 0.5rem;
        }

        .controls {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Sorting Algorithm Visualizer</h1>

      <div class="controls-section" id="controlsSection">
        <div class="slider-container">
          <div class="slider-label">
            <span>Array Size</span>
            <span class="slider-value" id="sizeValue">50</span>
          </div>
          <input
            type="range"
            id="sizeSlider"
            class="slider"
            min="10"
            max="100"
            value="50"
          />
          <div class="limit-info" id="limitInfo">
            Maximum size adjusted for screen width
          </div>
        </div>
        <div class="slider-container">
          <div class="slider-label">
            <span>Animation Speed</span>
            <span class="slider-value" id="speedValue">50</span>
          </div>
          <input
            type="range"
            id="speedSlider"
            class="slider"
            min="1"
            max="100"
            value="50"
          />
          <div class="limit-info">1 = Slow, 100 = Fast</div>
        </div>
      </div>

      <div class="animation-controls" id="animationControls">
        <div class="slider-container">
          <div class="slider-label">
            <span>Animation Speed</span>
            <span class="slider-value" id="speedValueAnim">50</span>
          </div>
          <input
            type="range"
            id="speedSliderAnim"
            class="slider"
            min="1"
            max="100"
            value="50"
          />
          <div class="limit-info">1 = Slow, 100 = Fast</div>
        </div>
        <button class="stop-btn" onclick="stopSort()">‚èπÔ∏è Stop</button>
      </div>

      <div class="controls" id="algorithmControls">
        <button onclick="randomizeArray()">üé≤ Randomize</button>
        <button onclick="startSort('bubble')">ü´ß Bubble Sort</button>
        <button onclick="startSort('selection')">üéØ Selection Sort</button>
        <button onclick="startSort('insertion')">üìù Insertion Sort</button>
        <button onclick="startSort('merge')">üîÑ Merge Sort</button>
        <button onclick="startSort('quick')">‚ö° Quick Sort</button>
        <button onclick="startSort('shell')">üêö Shell Sort</button>
      </div>

      <div class="visualization" id="visualization"></div>

      <div class="stats">
        <div class="stat">
          <div class="stat-label">Algorithm</div>
          <div class="stat-value" id="currentAlgorithm">None</div>
        </div>
        <div class="stat">
          <div class="stat-label">Comparisons</div>
          <div class="stat-value" id="comparisons">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">Array Accesses</div>
          <div class="stat-value" id="arrayAccesses">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">Time Elapsed</div>
          <div class="stat-value" id="time">0ms</div>
        </div>
      </div>

      <div class="info">
        <h3>üöÄ How to Use</h3>
        <p>
          <strong>1.</strong> Adjust array size and animation speed using the
          sliders above
        </p>
        <p>
          <strong>2.</strong> Click "üé≤ Randomize" to generate new random data
        </p>
        <p>
          <strong>3.</strong> Choose any sorting algorithm to watch it work step
          by step
        </p>
        <p>
          <strong>4.</strong> Use "‚èπÔ∏è Stop" to halt the animation at any time
        </p>

        <div class="color-legend">
          <div class="legend-item">
            <div class="legend-color legend-normal"></div>
            <span>Normal</span>
          </div>
          <div class="legend-item">
            <div class="legend-color legend-comparing"></div>
            <span>Comparing</span>
          </div>
          <div class="legend-item">
            <div class="legend-color legend-swapping"></div>
            <span>Swapping</span>
          </div>
          <div class="legend-item">
            <div class="legend-color legend-sorted"></div>
            <span>Sorted</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      let array = [];
      let arraySize = 50;
      let maxArraySize = 100;
      let animationSpeed = 50;
      let isAnimating = false;
      let animationTimeouts = [];
      let stats = { comparisons: 0, arrayAccesses: 0, startTime: 0 };

      function calculateMaxArraySize() {
        const visualization = document.getElementById("visualization");
        const containerWidth = visualization.clientWidth - 64;
        const minBarWidth = 6;
        const maxSize = Math.floor(containerWidth / minBarWidth);
        return Math.max(10, Math.min(200, maxSize));
      }

      function updateArraySizeLimits() {
        maxArraySize = calculateMaxArraySize();
        const slider = document.getElementById("sizeSlider");
        const limitInfo = document.getElementById("limitInfo");

        slider.max = maxArraySize;

        if (arraySize > maxArraySize) {
          arraySize = maxArraySize;
          slider.value = arraySize;
          document.getElementById("sizeValue").textContent = arraySize;
        }

        limitInfo.textContent = `Maximum: ${maxArraySize} (based on screen width)`;

        if (!isAnimating) randomizeArray();
      }

      function initializeApp() {
        updateArraySizeLimits();

        document
          .getElementById("sizeSlider")
          .addEventListener("input", function () {
            arraySize = parseInt(this.value);
            document.getElementById("sizeValue").textContent = arraySize;
            if (!isAnimating) randomizeArray();
          });

        document
          .getElementById("speedSlider")
          .addEventListener("input", function () {
            animationSpeed = parseInt(this.value);
            document.getElementById("speedValue").textContent = animationSpeed;
            document.getElementById("speedSliderAnim").value = animationSpeed;
            document.getElementById("speedValueAnim").textContent =
              animationSpeed;
          });

        document
          .getElementById("speedSliderAnim")
          .addEventListener("input", function () {
            animationSpeed = parseInt(this.value);
            document.getElementById("speedValueAnim").textContent =
              animationSpeed;
            document.getElementById("speedSlider").value = animationSpeed;
            document.getElementById("speedValue").textContent = animationSpeed;
          });

        let resizeTimeout;
        window.addEventListener("resize", function () {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(updateArraySizeLimits, 250);
        });
      }

      function randomizeArray() {
        if (isAnimating) return;

        array = [];
        const visualization = document.getElementById("visualization");
        const containerHeight = visualization.clientHeight || 420;
        const maxHeight = Math.max(100, containerHeight - 80);
        const minHeight = Math.max(20, Math.floor(maxHeight * 0.1));

        for (let i = 0; i < arraySize; i++) {
          array.push(
            Math.floor(Math.random() * (maxHeight - minHeight)) + minHeight
          );
        }

        resetStats();
        renderArray();
      }

      function renderArray() {
        const visualization = document.getElementById("visualization");
        visualization.innerHTML = "";

        const containerWidth = visualization.clientWidth - 64;
        const totalGaps = (arraySize - 1) * 2;
        const availableWidth = containerWidth - totalGaps;
        const barWidth = Math.max(4, Math.floor(availableWidth / arraySize));

        array.forEach((value, index) => {
          const bar = document.createElement("div");
          bar.className = "bar";
          bar.style.height = `${value}px`;
          bar.style.width = `${barWidth}px`;

          if (barWidth >= 20) {
            bar.textContent = value;
          }

          bar.id = `bar-${index}`;
          visualization.appendChild(bar);
        });
      }

      function resetStats() {
        stats = { comparisons: 0, arrayAccesses: 0, startTime: Date.now() };
        document.getElementById("comparisons").textContent = "0";
        document.getElementById("arrayAccesses").textContent = "0";
        document.getElementById("time").textContent = "0ms";
        document.getElementById("currentAlgorithm").textContent = "None";
      }

      function updateStats() {
        document.getElementById("comparisons").textContent =
          stats.comparisons.toLocaleString();
        document.getElementById("arrayAccesses").textContent =
          stats.arrayAccesses.toLocaleString();
        document.getElementById("time").textContent = `${
          Date.now() - stats.startTime
        }ms`;
      }

      function showAnimationMode() {
        document.getElementById("controlsSection").classList.add("hidden");
        document.getElementById("algorithmControls").classList.add("hidden");

        document.getElementById("animationControls").classList.add("visible");

        document.querySelector(".stop-btn").classList.add("visible");

        document.getElementById("speedSliderAnim").value = animationSpeed;
        document.getElementById("speedValueAnim").textContent = animationSpeed;
      }

      function hideAnimationMode() {
        document.getElementById("controlsSection").classList.remove("hidden");
        document.getElementById("algorithmControls").classList.remove("hidden");

        document
          .getElementById("animationControls")
          .classList.remove("visible");

        document.querySelector(".stop-btn").classList.remove("visible");
      }

      function highlightBars(indices, className) {
        document.querySelectorAll(".bar").forEach((bar) => {
          bar.classList.remove("comparing", "swapping", "sorted");
        });

        indices.forEach((index) => {
          const bar = document.getElementById(`bar-${index}`);
          if (bar) bar.classList.add(className);
        });
      }

      function swap(arr, i, j) {
        stats.arrayAccesses += 2;
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }

      function compare(arr, i, j) {
        stats.comparisons++;
        stats.arrayAccesses += 2;
        return arr[i] > arr[j];
      }

      async function animateStep(indices, className, delay = null) {
        return new Promise((resolve) => {
          highlightBars(indices, className);
          updateStats();

          const timeout = setTimeout(() => {
            renderArray();
            resolve();
          }, delay || (101 - animationSpeed) * 8);

          animationTimeouts.push(timeout);
        });
      }

      function startSort(algorithm) {
        if (isAnimating) return;

        isAnimating = true;
        resetStats();
        stats.startTime = Date.now();

        const algorithmNames = {
          bubble: "Bubble Sort",
          selection: "Selection Sort",
          insertion: "Insertion Sort",
          merge: "Merge Sort",
          quick: "Quick Sort",
          shell: "Shell Sort",
        };

        document.getElementById("currentAlgorithm").textContent =
          algorithmNames[algorithm];

        showAnimationMode();

        switch (algorithm) {
          case "bubble":
            bubbleSort();
            break;
          case "selection":
            selectionSort();
            break;
          case "insertion":
            insertionSort();
            break;
          case "merge":
            mergeSort();
            break;
          case "quick":
            quickSort();
            break;
          case "shell":
            shellSort();
            break;
        }
      }

      function stopSort() {
        isAnimating = false;
        animationTimeouts.forEach((timeout) => clearTimeout(timeout));
        animationTimeouts = [];

        hideAnimationMode();

        document.querySelectorAll(".bar").forEach((bar) => {
          bar.classList.remove("comparing", "swapping", "sorted");
        });
      }

      async function bubbleSort() {
        const arr = [...array];
        const n = arr.length;

        for (let i = 0; i < n - 1 && isAnimating; i++) {
          for (let j = 0; j < n - i - 1 && isAnimating; j++) {
            await animateStep([j, j + 1], "comparing");

            if (compare(arr, j, j + 1)) {
              swap(arr, j, j + 1);
              array = [...arr];
              await animateStep([j, j + 1], "swapping");
            }
          }
          await animateStep([n - i - 1], "sorted");
        }

        if (isAnimating) {
          for (let i = 0; i < n; i++) {
            await animateStep([i], "sorted", 50);
          }
        }

        stopSort();
      }

      async function selectionSort() {
        const arr = [...array];
        const n = arr.length;

        for (let i = 0; i < n - 1 && isAnimating; i++) {
          let minIdx = i;
          await animateStep([minIdx], "comparing");

          for (let j = i + 1; j < n && isAnimating; j++) {
            await animateStep([j, minIdx], "comparing");

            if (compare(arr, minIdx, j)) {
              minIdx = j;
            }
          }

          if (minIdx !== i) {
            swap(arr, i, minIdx);
            array = [...arr];
            await animateStep([i, minIdx], "swapping");
          }

          await animateStep([i], "sorted");
        }

        if (isAnimating) await animateStep([n - 1], "sorted");
        stopSort();
      }

      async function insertionSort() {
        const arr = [...array];
        const n = arr.length;

        for (let i = 1; i < n && isAnimating; i++) {
          let key = arr[i];
          let j = i - 1;

          await animateStep([i], "comparing");

          while (j >= 0 && isAnimating && arr[j] > key) {
            stats.comparisons++;
            stats.arrayAccesses += 2;

            await animateStep([j, j + 1], "comparing");

            arr[j + 1] = arr[j];
            array = [...arr];
            await animateStep([j + 1], "swapping");

            j--;
          }

          arr[j + 1] = key;
          array = [...arr];
          await animateStep([j + 1], "sorted", 50);
        }

        stopSort();
      }

      async function shellSort() {
        const arr = [...array];
        const n = arr.length;

        for (
          let gap = Math.floor(n / 2);
          gap > 0 && isAnimating;
          gap = Math.floor(gap / 2)
        ) {
          for (let i = gap; i < n && isAnimating; i++) {
            let temp = arr[i];
            let j = i;

            await animateStep([i], "comparing");

            while (j >= gap && isAnimating && arr[j - gap] > temp) {
              stats.comparisons++;
              stats.arrayAccesses += 2;

              await animateStep([j, j - gap], "comparing");

              arr[j] = arr[j - gap];
              array = [...arr];
              await animateStep([j], "swapping");

              j -= gap;
            }

            arr[j] = temp;
            array = [...arr];
          }
        }

        stopSort();
      }

      async function mergeSort() {
        const arr = [...array];
        await mergeSortHelper(arr, 0, arr.length - 1);
        array = [...arr];
        stopSort();
      }

      async function mergeSortHelper(arr, left, right) {
        if (left < right && isAnimating) {
          const mid = Math.floor((left + right) / 2);

          await mergeSortHelper(arr, left, mid);
          await mergeSortHelper(arr, mid + 1, right);
          await merge(arr, left, mid, right);
        }
      }

      async function merge(arr, left, mid, right) {
        const leftArr = arr.slice(left, mid + 1);
        const rightArr = arr.slice(mid + 1, right + 1);

        let i = 0,
          j = 0,
          k = left;

        while (i < leftArr.length && j < rightArr.length && isAnimating) {
          await animateStep([k], "comparing");

          stats.comparisons++;
          if (leftArr[i] <= rightArr[j]) {
            arr[k] = leftArr[i];
            i++;
          } else {
            arr[k] = rightArr[j];
            j++;
          }

          array = [...arr];
          await animateStep([k], "swapping");
          k++;
        }

        while (i < leftArr.length && isAnimating) {
          arr[k] = leftArr[i];
          array = [...arr];
          await animateStep([k], "swapping");
          i++;
          k++;
        }

        while (j < rightArr.length && isAnimating) {
          arr[k] = rightArr[j];
          array = [...arr];
          await animateStep([k], "swapping");
          j++;
          k++;
        }
      }

      async function quickSort() {
        const arr = [...array];
        await quickSortHelper(arr, 0, arr.length - 1);
        array = [...arr];
        stopSort();
      }

      async function quickSortHelper(arr, low, high) {
        if (low < high && isAnimating) {
          const pi = await partition(arr, low, high);
          await quickSortHelper(arr, low, pi - 1);
          await quickSortHelper(arr, pi + 1, high);
        }
      }

      async function partition(arr, low, high) {
        const pivot = arr[high];
        let i = low - 1;

        await animateStep([high], "comparing");

        for (let j = low; j < high && isAnimating; j++) {
          await animateStep([j, high], "comparing");

          if (arr[j] < pivot) {
            stats.comparisons++;
            i++;
            if (i !== j) {
              swap(arr, i, j);
              array = [...arr];
              await animateStep([i, j], "swapping");
            }
          }
        }

        swap(arr, i + 1, high);
        array = [...arr];
        await animateStep([i + 1, high], "swapping");

        return i + 1;
      }

      initializeApp();
    </script>
  </body>
</html>
